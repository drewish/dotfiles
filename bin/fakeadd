#!/bin/sh

if [ $# -eq 0 ]; then
	echo "usage: $0 file ..." 1>&2
	exit 1
fi

rv=0
for file in "$@"; do
	dir=`dirname $file`
	base=`basename $file`
	if [ -f "$file" ]; then :; else
		echo "$0: error: \"$file\" does not exist or is not a plain file"
		rv=1
		continue
	fi
	if [ -d "$dir/CVS" ]; then :; else
		echo "$0: fatal error: no CVS directory!
		rv=1
		continue
	fi
	if [ -f "$dir/CVS/Entries" ] && [ -w "$dir/CVS/Entries" ]; then :; else
		echo "$0: fatal error: CVS/Entries file not writable!
		rv=1
		continue
	fi

	if grep "^/$file/" "$dir/CVS/Entries" > /dev/null 2>&1; then
		echo "$0: error: \"$file\" is already listed in CVS/Entries"
		rv=1
		continue
fi

echo "/$base/0/dummy timestamp//" >> "$dir/CVS/Entries"
echo "$0: added \"$file\""
done
exit $rv

